# looking-glass — REPO_ATLAS (what exists, where it lives)

This bundle is a high-signal map of the SANDBOX_LORE repository: what the major directories are for, what kinds of artifacts they hold, and which entrypoints are considered stable.

Scope: repo organization + tooling surfaces. It does **not** try to re-explain Seatbelt itself (see `SANDBOX.md`) or enumerate boundary objects (see `WITNESSES.md`).

Baseline anchor: Sonoma 14.4.1 (23E224) Apple Silicon, SIP enabled; `world_id sonoma-14.4.1-23E224-arm64-dyld-2c0602c5`.

## Operational root

The operational root of the repo is `book/`. When someone says “the project,” they usually mean the data, tooling, and invariants under `book/`.

## Top-level directory map

- `book/`
  - The host-bound “textbook + workbench.”
  - Contains the world baseline record, toolchain CLIs, mappings/IR, experiments, integration tests, and the frozen query bundle (CARTON).
- `guidance/`
  - Prompt/context bundles for agent roles (including this `looking-glass` bundle set).
  - These are convenience copies for editing/review; they are not the source of truth for host evidence.
- `troubles/`
  - Troubleshooting notes and process documents (scoped by their own AGENTS).
- `status/`
  - Repo status tracking (human-facing).

## `book/` directory atlas (what lives where)

### `book/world/` — world baselines (the binding contract)

- `book/world/<world_name>/world.json` is the baseline record for a host world.
- `book/world/registry.json` is the index: tools resolve the default baseline from here.

See: `WORLD_AND_EVIDENCE.md` (world model).

### `book/substrate/` — vocabulary + conceptual substrate

- Human-readable substrate documents (definitions, lifecycle framing, naming discipline).
- The Swift generator treats these as inputs and produces structured JSON that other tools consume.

### `book/graph/` — concept inventory + generator/validator

This is the typed “graph generator” target that keeps inventory + routing metadata in sync.

- Run it with: `cd book/graph && swift run`
- Outputs: concept JSON and validation reports (see `GRAPH_AND_MAPPINGS.md`).

### `book/graph/mappings/` — stable host-bound IR

This is the home of “pinned facts” (vocab tables, anchors, runtime coverage, profile digests, etc.).

Examples of subtrees:
- `book/graph/mappings/vocab/` — op + filter vocabulary (bedrock).
- `book/graph/mappings/system_profiles/` — canonical system profile contracts/digests (bedrock anchors).
- `book/graph/mappings/runtime/` — promoted runtime summaries (mapped; scenario-scoped).

### `book/api/` — CLI/tooling surface

Python modules that provide stable CLIs and programmatic APIs:
- `book.api.profile` — SBPL compilation + blob decoding/inspection.
- `book.api.runtime` — plan-based runtime harness + bundle/promotion tooling.
- `book.api.witness` — PolicyWitness.app API surface (App Sandbox + entitlements probing + observer capture).
- `book.api.world` — world registry resolution.
- `book.api.path_utils` — repo-relative path normalization helpers.
- `book.api.ghidra` — Ghidra task registry helpers and dump wiring.

See: `PROFILE_TOOLCHAIN.md` and `RUNTIME_AND_WITNESS_TOOLCHAIN.md`.

### `book/tools/` — operational helpers and bundled binaries

This is where “small tools” and the bundled macOS apps/binaries live.

Notable subtrees:
- `book/tools/preflight/` — apply-gate preflight and minimization tooling.
- `book/tools/sbpl/wrapper/` — wrapper binary used in some apply/probe workflows.
- `book/tools/witness/` — PolicyWitness.app + fixtures (contract surfaces).
- `book/tools/doctor/` — baseline/world consistency checkups.

### `book/integration/` — guardrails + CI harness + CARTON

- `book/integration/tests/` — pytest guardrails that make drift obvious.
- `book/integration/ci.py` — unified harness invoked by `make -C book test`.
- `book/integration/carton/` — CARTON bundle + fix/update/check/diff tools.

See: `CARTON_AND_GUARDRAILS.md`.

### `book/evidence/experiments/` — witness generators (not the contract boundary)

Experiments are allowed to be messy; their outputs become durable only when promoted into:
- `book/evidence/graph/concepts/validation/out/` (normalized IR), or
- `book/graph/mappings/` (stable host mappings), or
- `book/integration/carton/bundle/` (frozen query layer).

### `book/examples/` and `book/profiles/`

- `book/examples/` — reader-facing examples; some are generated by the Swift graph target.
- `book/profiles/` — SBPL profiles used by experiments and examples.

### `book/dumps/`

Host-bound dumps (including Ghidra outputs). This subtree has stricter rules in its own AGENTS; treat it as evidence storage, not a place to improvise.

## Stable entrypoints (what the repo “supports”)

Repo-wide:
- Only supported test runner: `make -C book test`

Core generation/update surfaces:
- Graph generator: `cd book/graph && swift run`
- Mappings promotion: `python book/graph/mappings/run_promotion.py`
- CARTON refresh: `python -m book.integration.carton.tools.update` (or `make -C book carton-refresh`)

Core CLIs:
- Profile tooling: `python -m book.api.profile ...`
- Runtime tooling: `python -m book.api.runtime ...`
- PolicyWitness harness: `book/tools/witness/PolicyWitness.app` (CLI: `policy-witness`, `sandbox-log-observer`); Python API surface: `book.api.witness` (importable module)

## “Where truth lives” (a useful mental model)

SANDBOX_LORE tries to keep knowledge in *checkable boundary objects* rather than prose:
- **Substrate + concepts** define names and lifecycle framing.
- **Mappings** encode host-bound structural facts (vocab, anchors, profile digests).
- **Runtime bundles + promotion packets** encode observed behavior with stage/lane labeling.
- **CARTON** freezes a small queryable slice (relationships/views/contracts) with manifest verification.

If a claim can’t point to one of those surfaces, it is treated as generic lore or hypothesis.
