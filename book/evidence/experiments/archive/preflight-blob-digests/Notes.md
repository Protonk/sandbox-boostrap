# preflight-blob-digests notes

- Created experiment scaffold (`Report.md` is canonical; `Plan.md` points to it).
- Generated `out/apply_gate_blob_digests.json` from the gate-witnesses validation output:
  - `python3 book/evidence/experiments/preflight-blob-digests/collect_gate_blob_digests.py --out book/evidence/experiments/preflight-blob-digests/out/apply_gate_blob_digests.json`
- Ran validation to emit tool-consumed IR under `book/evidence/graph/concepts/validation/out/experiments/preflight-blob-digests/`:
  - `PYTHONPATH=$PWD python3 -m book.integration.carton validate --experiment preflight-blob-digests`
- Inventoried all in-repo `*.sb.bin` blobs and computed sha256s:
  - `python3 book/evidence/experiments/preflight-blob-digests/inventory_repo_blobs.py --out book/evidence/experiments/preflight-blob-digests/out/repo_sb_bin_inventory.json`
- Joined the repo inventory against canonical `sys:*` digests and the current preflight digest corpus:
  - `python3 book/evidence/experiments/preflight-blob-digests/join_with_sys_digests.py --out book/evidence/experiments/preflight-blob-digests/out/sys_digest_join.json`
- Checked blob digest determinism and Python-vs-wrapper compile parity on two SBPL inputs:
  - `python3 book/evidence/experiments/preflight-blob-digests/compile_determinism.py --sbpl book/evidence/experiments/op-table-operation/sb/v0_empty.sb --sbpl book/evidence/experiments/gate-witnesses/out/witnesses/mach_bootstrap_deny_message_send/minimal_failing.sb --runs 5 --out book/evidence/experiments/preflight-blob-digests/out/compile_determinism.json`
- Ran a blob apply matrix in the harness context (expected to be globally apply-gated here):
  - `python3 book/evidence/experiments/preflight-blob-digests/blob_apply_matrix.py --label in_harness --blob book/evidence/graph/concepts/validation/fixtures/blobs/airlock.sb.bin --blob book/evidence/graph/concepts/validation/fixtures/blobs/bsd.sb.bin --blob book/evidence/graph/concepts/validation/fixtures/blobs/sample.sb.bin --out book/evidence/experiments/preflight-blob-digests/out/blob_apply_matrix.in_harness.json`
- Ran the same blob apply matrix outside the harness sandbox (via escalated execution) to classify canonical sys blobs:
  - `python3 book/evidence/experiments/preflight-blob-digests/blob_apply_matrix.py --label outside_harness --blob book/evidence/graph/concepts/validation/fixtures/blobs/airlock.sb.bin --blob book/evidence/graph/concepts/validation/fixtures/blobs/bsd.sb.bin --blob book/evidence/graph/concepts/validation/fixtures/blobs/sample.sb.bin --out book/evidence/experiments/preflight-blob-digests/out/blob_apply_matrix.outside_harness.json`
- Regenerated the apply-gate digest corpus, folding in the outside-harness blob apply matrix:
  - `python3 book/evidence/experiments/preflight-blob-digests/collect_gate_blob_digests.py --apply-matrix book/evidence/experiments/preflight-blob-digests/out/blob_apply_matrix.outside_harness.json --out book/evidence/experiments/preflight-blob-digests/out/apply_gate_blob_digests.json`
- Compared the in-harness vs outside-harness blob apply matrices to detect outcome flips:
  - `python3 book/evidence/experiments/preflight-blob-digests/compare_apply_matrices.py --matrix book/evidence/experiments/preflight-blob-digests/out/blob_apply_matrix.in_harness.json --matrix book/evidence/experiments/preflight-blob-digests/out/blob_apply_matrix.outside_harness.json --out book/evidence/experiments/preflight-blob-digests/out/apply_matrix_comparison.json`
- Collected a small “known not apply-gated” control digest set from gate-witnesses + the apply matrices:
  - `python3 book/evidence/experiments/preflight-blob-digests/collect_control_digests.py --apply-matrix book/evidence/experiments/preflight-blob-digests/out/blob_apply_matrix.in_harness.json --apply-matrix book/evidence/experiments/preflight-blob-digests/out/blob_apply_matrix.outside_harness.json --out book/evidence/experiments/preflight-blob-digests/out/control_digests.json`
- Froze the labeled digest sets for structural signal listening:
  - `python3 book/evidence/experiments/preflight-blob-digests/freeze_structural_sets.py --out book/evidence/experiments/preflight-blob-digests/out/structural_signal_sets.json`
- Extracted compact structural features for all unique in-repo blob digests (149/149 decoded successfully):
  - `python3 book/evidence/experiments/preflight-blob-digests/extract_structural_features.py --inventory book/evidence/experiments/preflight-blob-digests/out/repo_sb_bin_inventory.json --sets book/evidence/experiments/preflight-blob-digests/out/structural_signal_sets.json --out book/evidence/experiments/preflight-blob-digests/out/blob_structural_features.json`
- Derived a first candidate set of structural signatures (partial/brittle; labeled-set only) from the decoded features:
  - `python3 book/evidence/experiments/preflight-blob-digests/derive_signature_candidates.py --out book/evidence/experiments/preflight-blob-digests/out/structural_signature_candidates.json`
- Scanned the full in-repo digest corpus for candidate signature hits:
  - `python3 book/evidence/experiments/preflight-blob-digests/scan_structural_signatures.py --candidates book/evidence/experiments/preflight-blob-digests/out/structural_signature_candidates.json --out book/evidence/experiments/preflight-blob-digests/out/structural_signature_scan.json`
- Ran an “outside harness” blob apply matrix for a small batch of structurally interesting unknown digests (control_ok context):
  - `python3 book/evidence/experiments/preflight-blob-digests/blob_apply_matrix.py --label structural_validation_batch1 --blob book/evidence/experiments/gate-witnesses/out/micro_variants/base_v2_inner_allow_external_method.sb.bin --blob book/evidence/experiments/gate-witnesses/out/micro_variants/base_v2_inner_deny_async_external_method.sb.bin --blob book/evidence/experiments/gate-witnesses/out/micro_variants/base_v2_inner_deny_external_trap.sb.bin --blob book/evidence/experiments/field2-final-final/field2-filters/sb/build/flow_divert_mixed.sb.bin --blob book/evidence/experiments/gate-witnesses/out/witnesses/airlock/compile_vs_apply/passing_neighbor.sb.bin --blob book/evidence/experiments/gate-witnesses/out/micro_variants/base_v2_mach_bootstrap_allow_only.sb.bin --blob book/evidence/experiments/gate-witnesses/out/micro_variants/base_v2_mach_bootstrap_allow_only_with_file_write.sb.bin --blob book/evidence/experiments/field2-final-final/probe-op-structure/sb/build/v5_iokit_class_property.sb.bin --out book/evidence/experiments/preflight-blob-digests/out/blob_apply_matrix.structural_validation_batch1.json`
- Regenerated the apply-gate digest corpus, folding in both sys fixture apply results and the structural-validation batch:
  - `python3 book/evidence/experiments/preflight-blob-digests/collect_gate_blob_digests.py --apply-matrix book/evidence/experiments/preflight-blob-digests/out/blob_apply_matrix.outside_harness.json --apply-matrix book/evidence/experiments/preflight-blob-digests/out/blob_apply_matrix.structural_validation_batch1.json --out book/evidence/experiments/preflight-blob-digests/out/apply_gate_blob_digests.json`
- Refreshed the tool-consumed digest IR via the validation driver:
  - `PYTHONPATH=$PWD python3 -m book.integration.carton validate --experiment preflight-blob-digests`
- Regenerated the control digest set, folding in the structural-validation batch’s apply-ok blob(s):
  - `python3 book/evidence/experiments/preflight-blob-digests/collect_control_digests.py --apply-matrix book/evidence/experiments/preflight-blob-digests/out/blob_apply_matrix.in_harness.json --apply-matrix book/evidence/experiments/preflight-blob-digests/out/blob_apply_matrix.outside_harness.json --apply-matrix book/evidence/experiments/preflight-blob-digests/out/blob_apply_matrix.structural_validation_batch1.json --out book/evidence/experiments/preflight-blob-digests/out/control_digests.json`
- Refroze the labeled sets and regenerated the structural-signal artifacts after expanding the apply-gate and control digests:
  - `python3 book/evidence/experiments/preflight-blob-digests/freeze_structural_sets.py --out book/evidence/experiments/preflight-blob-digests/out/structural_signal_sets.json`
  - `python3 book/evidence/experiments/preflight-blob-digests/extract_structural_features.py --inventory book/evidence/experiments/preflight-blob-digests/out/repo_sb_bin_inventory.json --sets book/evidence/experiments/preflight-blob-digests/out/structural_signal_sets.json --out book/evidence/experiments/preflight-blob-digests/out/blob_structural_features.json`
  - `python3 book/evidence/experiments/preflight-blob-digests/derive_signature_candidates.py --out book/evidence/experiments/preflight-blob-digests/out/structural_signature_candidates.json`
  - `python3 book/evidence/experiments/preflight-blob-digests/scan_structural_signatures.py --candidates book/evidence/experiments/preflight-blob-digests/out/structural_signature_candidates.json --out book/evidence/experiments/preflight-blob-digests/out/structural_signature_scan.json`
- Ran a second “outside harness” apply-validation batch with a mix of micro-variants and broader corpus blobs:
  - `python3 book/evidence/experiments/preflight-blob-digests/blob_apply_matrix.py --label structural_validation_batch2 --blob book/evidence/experiments/gate-witnesses/out/micro_variants/base_v1_inner_allow_external_method.sb.bin --blob book/evidence/experiments/gate-witnesses/out/micro_variants/base_v1_inner_deny_async_external_method.sb.bin --blob book/evidence/experiments/gate-witnesses/out/micro_variants/base_v1_inner_deny_external_trap.sb.bin --blob book/evidence/experiments/gate-witnesses/out/micro_variants/base_v2_mach_bootstrap_deny_message_send.sb.bin --blob book/evidence/experiments/entitlement-diff/sb/build/appsandbox-baseline.sb.bin --blob book/evidence/experiments/entitlement-diff/sb/build/appsandbox-network-mach.sb.bin --blob book/evidence/experiments/field2-final-final/probe-op-structure/sb/build/v8_all_combo.sb.bin --blob book/evidence/experiments/field2-final-final/libsandbox-encoder/out/matrix_v2.sb.bin --out book/evidence/experiments/preflight-blob-digests/out/blob_apply_matrix.structural_validation_batch2.json`
- Folded the batch2 apply-gated results into the digest corpus and refreshed IR:
  - `python3 book/evidence/experiments/preflight-blob-digests/collect_gate_blob_digests.py --apply-matrix book/evidence/experiments/preflight-blob-digests/out/blob_apply_matrix.outside_harness.json --apply-matrix book/evidence/experiments/preflight-blob-digests/out/blob_apply_matrix.structural_validation_batch1.json --apply-matrix book/evidence/experiments/preflight-blob-digests/out/blob_apply_matrix.structural_validation_batch2.json --out book/evidence/experiments/preflight-blob-digests/out/apply_gate_blob_digests.json`
  - `python3 book/evidence/experiments/preflight-blob-digests/collect_control_digests.py --apply-matrix book/evidence/experiments/preflight-blob-digests/out/blob_apply_matrix.in_harness.json --apply-matrix book/evidence/experiments/preflight-blob-digests/out/blob_apply_matrix.outside_harness.json --apply-matrix book/evidence/experiments/preflight-blob-digests/out/blob_apply_matrix.structural_validation_batch1.json --apply-matrix book/evidence/experiments/preflight-blob-digests/out/blob_apply_matrix.structural_validation_batch2.json --out book/evidence/experiments/preflight-blob-digests/out/control_digests.json`
  - `PYTHONPATH=$PWD python3 -m book.integration.carton validate --experiment preflight-blob-digests`
- Regenerated the structural-signal artifacts again after the batch2 expansion:
  - `python3 book/evidence/experiments/preflight-blob-digests/freeze_structural_sets.py --out book/evidence/experiments/preflight-blob-digests/out/structural_signal_sets.json`
  - `python3 book/evidence/experiments/preflight-blob-digests/extract_structural_features.py --inventory book/evidence/experiments/preflight-blob-digests/out/repo_sb_bin_inventory.json --sets book/evidence/experiments/preflight-blob-digests/out/structural_signal_sets.json --out book/evidence/experiments/preflight-blob-digests/out/blob_structural_features.json`
  - `python3 book/evidence/experiments/preflight-blob-digests/derive_signature_candidates.py --out book/evidence/experiments/preflight-blob-digests/out/structural_signature_candidates.json`
  - `python3 book/evidence/experiments/preflight-blob-digests/scan_structural_signatures.py --candidates book/evidence/experiments/preflight-blob-digests/out/structural_signature_candidates.json --out book/evidence/experiments/preflight-blob-digests/out/structural_signature_scan.json`
- Regenerated structural features and candidate scans after adding derived “density/ratio” scalars (and emitted a relaxed-threshold scan):
  - `python3 book/evidence/experiments/preflight-blob-digests/extract_structural_features.py --inventory book/evidence/experiments/preflight-blob-digests/out/repo_sb_bin_inventory.json --sets book/evidence/experiments/preflight-blob-digests/out/structural_signal_sets.json --out book/evidence/experiments/preflight-blob-digests/out/blob_structural_features.json`
  - `python3 book/evidence/experiments/preflight-blob-digests/derive_signature_candidates.py --out book/evidence/experiments/preflight-blob-digests/out/structural_signature_candidates.json`
  - `python3 book/evidence/experiments/preflight-blob-digests/scan_structural_signatures.py --candidates book/evidence/experiments/preflight-blob-digests/out/structural_signature_candidates.json --out book/evidence/experiments/preflight-blob-digests/out/structural_signature_scan.json`
  - `python3 book/evidence/experiments/preflight-blob-digests/scan_structural_signatures.py --high-precision-threshold 0.75 --candidates book/evidence/experiments/preflight-blob-digests/out/structural_signature_candidates.json --out book/evidence/experiments/preflight-blob-digests/out/structural_signature_scan.p75.json`
- Ran a third “outside harness” apply-validation batch seeded by the scan shortlist (plus a few airlock-adjacent blobs):
  - `python3 book/evidence/experiments/preflight-blob-digests/blob_apply_matrix.py --label structural_validation_batch3_scan_shortlist --blob book/evidence/experiments/gate-witnesses/out/micro_variants/base_v2_inner_allow_external_method.sb.bin --blob book/evidence/experiments/sandbox-init-params/out/named_mDNSResponder.sb.bin --blob book/evidence/experiments/field2-final-final/libsandbox-encoder/out/matrix_v1.sb.bin --blob book/evidence/experiments/sandbox-init-params/out/file_ftp_proxy.sb.bin --blob book/evidence/experiments/field2-final-final/libsandbox-encoder/sb/matrix_v1_domain30.sb.bin --blob book/evidence/experiments/field2-final-final/bsd-airlock-highvals/sb/build/airlock_system_fcntl_literal_guard.sb.bin --blob book/evidence/experiments/field2-final-final/bsd-airlock-highvals/sb/build/bsd_tag26_matrix.sb.bin --blob book/evidence/experiments/field2-final-final/field2-filters/sb/build/bsd_tail_context.sb.bin --blob book/evidence/experiments/runtime-adversarial/out/sb_build/net_outbound_deny.sb.bin --blob book/evidence/experiments/sbpl-graph-runtime/out/deny_all.sb.bin --out book/evidence/experiments/preflight-blob-digests/out/blob_apply_matrix.structural_validation_batch3_scan_shortlist.json`
- Refreshed the control digest set to fold in batch3 apply-ok blobs and regenerated the structural-signal artifacts:
  - `python3 book/evidence/experiments/preflight-blob-digests/collect_control_digests.py --apply-matrix book/evidence/experiments/preflight-blob-digests/out/blob_apply_matrix.in_harness.json --apply-matrix book/evidence/experiments/preflight-blob-digests/out/blob_apply_matrix.outside_harness.json --apply-matrix book/evidence/experiments/preflight-blob-digests/out/blob_apply_matrix.structural_validation_batch1.json --apply-matrix book/evidence/experiments/preflight-blob-digests/out/blob_apply_matrix.structural_validation_batch2.json --apply-matrix book/evidence/experiments/preflight-blob-digests/out/blob_apply_matrix.structural_validation_batch3_scan_shortlist.json --out book/evidence/experiments/preflight-blob-digests/out/control_digests.json`
  - `python3 book/evidence/experiments/preflight-blob-digests/freeze_structural_sets.py --out book/evidence/experiments/preflight-blob-digests/out/structural_signal_sets.json`
  - `python3 book/evidence/experiments/preflight-blob-digests/extract_structural_features.py --inventory book/evidence/experiments/preflight-blob-digests/out/repo_sb_bin_inventory.json --sets book/evidence/experiments/preflight-blob-digests/out/structural_signal_sets.json --out book/evidence/experiments/preflight-blob-digests/out/blob_structural_features.json`
  - `python3 book/evidence/experiments/preflight-blob-digests/derive_signature_candidates.py --out book/evidence/experiments/preflight-blob-digests/out/structural_signature_candidates.json`
  - `python3 book/evidence/experiments/preflight-blob-digests/scan_structural_signatures.py --candidates book/evidence/experiments/preflight-blob-digests/out/structural_signature_candidates.json --out book/evidence/experiments/preflight-blob-digests/out/structural_signature_scan.json`
  - `python3 book/evidence/experiments/preflight-blob-digests/scan_structural_signatures.py --high-precision-threshold 0.75 --candidates book/evidence/experiments/preflight-blob-digests/out/structural_signature_candidates.json --out book/evidence/experiments/preflight-blob-digests/out/structural_signature_scan.p75.json`
