{
  "description": "Targeted runtime discriminator matrices for anchor -> filter mapping.",
  "plan": {
    "apply_preflight_profile": "book/experiments/hardened-runtime/sb/apply_preflight_allow.sb",
    "controls": {
      "baseline": true
    },
    "lanes": {
      "baseline": true,
      "oracle": true,
      "scenario": true
    },
    "notes": "Predicate discriminator matrix for com.apple.cfprefsd.agent anchor: establish reachability under deny-default, then discriminate global-name vs local-name with allow/deny controls.",
    "plan_id": "anchor-filter-map.cfprefsd.v1",
    "profiles": [
      "anchor-filter-map:cfprefsd:S0_allow_any",
      "anchor-filter-map:cfprefsd:S1_allow_global",
      "anchor-filter-map:cfprefsd:S2_allow_local",
      "anchor-filter-map:cfprefsd:S3_allow_both",
      "anchor-filter-map:cfprefsd:N1_deny_default",
      "anchor-filter-map:cfprefsd:C1_deny_global",
      "anchor-filter-map:cfprefsd:C2_deny_local"
    ],
    "registry_id": "anchor-filter-map",
    "schema_version": "runtime-tools.plan.v0.1",
    "world_id": "sonoma-14.4.1-23E224-arm64-dyld-2c0602c5"
  },
  "probes": {
    "probes": {
      "anchor-filter-map:cfprefsd:C1_deny_global": {
        "anchor_ctx_id": "ctx:bd2b79af19c45bf1",
        "capabilities_required": [],
        "controls_supported": [
          "baseline",
          "allow_default",
          "deny_default"
        ],
        "driver": "sandbox_mach_probe",
        "expected": "deny",
        "expected_predicates": [
          "com.apple.cfprefsd.agent"
        ],
        "expected_primary_ops": [
          "mach-lookup"
        ],
        "name": "C1_deny_global",
        "operation": "mach-lookup",
        "probe_id": "anchor-filter-map:cfprefsd:C1_deny_global",
        "supports_lanes": {
          "baseline": true,
          "oracle": true,
          "scenario": true
        },
        "target": "com.apple.cfprefsd.agent",
        "filter_name": "global-name"
      },
      "anchor-filter-map:cfprefsd:C2_deny_local": {
        "anchor_ctx_id": "ctx:bd2b79af19c45bf1",
        "capabilities_required": [],
        "controls_supported": [
          "baseline",
          "allow_default",
          "deny_default"
        ],
        "driver": "sandbox_mach_probe",
        "expected": "deny",
        "expected_predicates": [
          "com.apple.cfprefsd.agent"
        ],
        "expected_primary_ops": [
          "mach-lookup"
        ],
        "name": "C2_deny_local",
        "operation": "mach-lookup",
        "probe_id": "anchor-filter-map:cfprefsd:C2_deny_local",
        "supports_lanes": {
          "baseline": true,
          "oracle": true,
          "scenario": true
        },
        "target": "com.apple.cfprefsd.agent",
        "filter_name": "local-name"
      },
      "anchor-filter-map:cfprefsd:N1_deny_default": {
        "anchor_ctx_id": "ctx:bd2b79af19c45bf1",
        "capabilities_required": [],
        "controls_supported": [
          "baseline",
          "allow_default",
          "deny_default"
        ],
        "driver": "sandbox_mach_probe",
        "expected": "deny",
        "expected_predicates": [
          "com.apple.cfprefsd.agent"
        ],
        "expected_primary_ops": [
          "mach-lookup"
        ],
        "name": "N1_deny_default",
        "operation": "mach-lookup",
        "probe_id": "anchor-filter-map:cfprefsd:N1_deny_default",
        "supports_lanes": {
          "baseline": true,
          "oracle": true,
          "scenario": true
        },
        "target": "com.apple.cfprefsd.agent",
        "filter_name": "global-name"
      },
      "anchor-filter-map:cfprefsd:S0_allow_any": {
        "anchor_ctx_id": "ctx:bd2b79af19c45bf1",
        "capabilities_required": [],
        "controls_supported": [
          "baseline",
          "allow_default",
          "deny_default"
        ],
        "driver": "sandbox_mach_probe",
        "expected": "allow",
        "expected_predicates": [
          "com.apple.cfprefsd.agent"
        ],
        "expected_primary_ops": [
          "mach-lookup"
        ],
        "name": "S0_allow_any",
        "operation": "mach-lookup",
        "probe_id": "anchor-filter-map:cfprefsd:S0_allow_any",
        "supports_lanes": {
          "baseline": true,
          "oracle": true,
          "scenario": true
        },
        "target": "com.apple.cfprefsd.agent",
        "filter_name": "global-name"
      },
      "anchor-filter-map:cfprefsd:S1_allow_global": {
        "anchor_ctx_id": "ctx:bd2b79af19c45bf1",
        "capabilities_required": [],
        "controls_supported": [
          "baseline",
          "allow_default",
          "deny_default"
        ],
        "driver": "sandbox_mach_probe",
        "expected": "allow",
        "expected_predicates": [
          "com.apple.cfprefsd.agent"
        ],
        "expected_primary_ops": [
          "mach-lookup"
        ],
        "name": "S1_allow_global",
        "operation": "mach-lookup",
        "probe_id": "anchor-filter-map:cfprefsd:S1_allow_global",
        "supports_lanes": {
          "baseline": true,
          "oracle": true,
          "scenario": true
        },
        "target": "com.apple.cfprefsd.agent",
        "filter_name": "global-name"
      },
      "anchor-filter-map:cfprefsd:S2_allow_local": {
        "anchor_ctx_id": "ctx:bd2b79af19c45bf1",
        "capabilities_required": [],
        "controls_supported": [
          "baseline",
          "allow_default",
          "deny_default"
        ],
        "driver": "sandbox_mach_probe",
        "expected": "allow",
        "expected_predicates": [
          "com.apple.cfprefsd.agent"
        ],
        "expected_primary_ops": [
          "mach-lookup"
        ],
        "name": "S2_allow_local",
        "operation": "mach-lookup",
        "probe_id": "anchor-filter-map:cfprefsd:S2_allow_local",
        "supports_lanes": {
          "baseline": true,
          "oracle": true,
          "scenario": true
        },
        "target": "com.apple.cfprefsd.agent",
        "filter_name": "local-name"
      },
      "anchor-filter-map:cfprefsd:S3_allow_both": {
        "anchor_ctx_id": "ctx:bd2b79af19c45bf1",
        "capabilities_required": [],
        "controls_supported": [
          "baseline",
          "allow_default",
          "deny_default"
        ],
        "driver": "sandbox_mach_probe",
        "expected": "allow",
        "expected_predicates": [
          "com.apple.cfprefsd.agent"
        ],
        "expected_primary_ops": [
          "mach-lookup"
        ],
        "name": "S3_allow_both",
        "operation": "mach-lookup",
        "probe_id": "anchor-filter-map:cfprefsd:S3_allow_both",
        "supports_lanes": {
          "baseline": true,
          "oracle": true,
          "scenario": true
        },
        "target": "com.apple.cfprefsd.agent",
        "filter_name": "global-name"
      },
      "anchor-filter-map:cfprefsd:bogus_baseline": {
        "capabilities_required": [],
        "controls_supported": [
          "baseline",
          "allow_default",
          "deny_default"
        ],
        "driver": "sandbox_mach_probe",
        "expected": "deny",
        "expected_predicates": [
          "com.apple.sandbox-lore.anchor-filter-map.bogus"
        ],
        "expected_primary_ops": [
          "mach-lookup"
        ],
        "name": "bogus_baseline",
        "operation": "mach-lookup",
        "probe_id": "anchor-filter-map:cfprefsd:bogus_baseline",
        "supports_lanes": {
          "baseline": true,
          "oracle": true,
          "scenario": true
        },
        "target": "com.apple.sandbox-lore.anchor-filter-map.bogus",
        "filter_name": "global-name"
      },
      "anchor-filter-map:iokit_class:C1_deny_class": {
        "capabilities_required": [],
        "controls_supported": [
          "baseline",
          "allow_default",
          "deny_default"
        ],
        "driver": "sandbox_iokit_probe",
        "expected": "deny",
        "expected_predicates": [
          "IOUSBHostInterface"
        ],
        "expected_primary_ops": [
          "iokit-open-service"
        ],
        "name": "C1_deny_class",
        "operation": "iokit-open-service",
        "probe_id": "anchor-filter-map:iokit_class:C1_deny_class",
        "supports_lanes": {
          "baseline": true,
          "oracle": true,
          "scenario": true
        },
        "target": "IOUSBHostInterface"
      },
      "anchor-filter-map:iokit_class:C2_deny_property_literal": {
        "capabilities_required": [],
        "controls_supported": [
          "baseline",
          "allow_default",
          "deny_default"
        ],
        "driver": "sandbox_iokit_probe",
        "expected": "deny",
        "expected_predicates": [
          "IOUSBHostInterface"
        ],
        "expected_primary_ops": [
          "iokit-open-service"
        ],
        "name": "C2_deny_property_literal",
        "operation": "iokit-open-service",
        "probe_id": "anchor-filter-map:iokit_class:C2_deny_property_literal",
        "supports_lanes": {
          "baseline": true,
          "oracle": true,
          "scenario": true
        },
        "target": "IOUSBHostInterface"
      },
      "anchor-filter-map:iokit_class:N1_deny_default": {
        "capabilities_required": [],
        "controls_supported": [
          "baseline",
          "allow_default",
          "deny_default"
        ],
        "driver": "sandbox_iokit_probe",
        "expected": "deny",
        "expected_predicates": [
          "IOUSBHostInterface"
        ],
        "expected_primary_ops": [
          "iokit-open-service"
        ],
        "name": "N1_deny_default",
        "operation": "iokit-open-service",
        "probe_id": "anchor-filter-map:iokit_class:N1_deny_default",
        "supports_lanes": {
          "baseline": true,
          "oracle": true,
          "scenario": true
        },
        "target": "IOUSBHostInterface"
      },
      "anchor-filter-map:iokit_class:S0_allow_any": {
        "capabilities_required": [],
        "controls_supported": [
          "baseline",
          "allow_default",
          "deny_default"
        ],
        "driver": "sandbox_iokit_probe",
        "expected": "allow",
        "expected_predicates": [
          "IOUSBHostInterface"
        ],
        "expected_primary_ops": [
          "iokit-open-service"
        ],
        "name": "S0_allow_any",
        "operation": "iokit-open-service",
        "probe_id": "anchor-filter-map:iokit_class:S0_allow_any",
        "supports_lanes": {
          "baseline": true,
          "oracle": true,
          "scenario": true
        },
        "target": "IOUSBHostInterface"
      },
      "anchor-filter-map:iokit_class:S1_allow_class": {
        "capabilities_required": [],
        "controls_supported": [
          "baseline",
          "allow_default",
          "deny_default"
        ],
        "driver": "sandbox_iokit_probe",
        "expected": "allow",
        "expected_predicates": [
          "IOUSBHostInterface"
        ],
        "expected_primary_ops": [
          "iokit-open-service"
        ],
        "name": "S1_allow_class",
        "operation": "iokit-open-service",
        "probe_id": "anchor-filter-map:iokit_class:S1_allow_class",
        "supports_lanes": {
          "baseline": true,
          "oracle": true,
          "scenario": true
        },
        "target": "IOUSBHostInterface"
      },
      "anchor-filter-map:iokit_class:S2_allow_property_literal": {
        "capabilities_required": [],
        "controls_supported": [
          "baseline",
          "allow_default",
          "deny_default"
        ],
        "driver": "sandbox_iokit_probe",
        "expected": "allow",
        "expected_predicates": [
          "IOUSBHostInterface"
        ],
        "expected_primary_ops": [
          "iokit-open-service"
        ],
        "name": "S2_allow_property_literal",
        "operation": "iokit-open-service",
        "probe_id": "anchor-filter-map:iokit_class:S2_allow_property_literal",
        "supports_lanes": {
          "baseline": true,
          "oracle": true,
          "scenario": true
        },
        "target": "IOUSBHostInterface"
      },
      "anchor-filter-map:iokit_class:S3_allow_both": {
        "capabilities_required": [],
        "controls_supported": [
          "baseline",
          "allow_default",
          "deny_default"
        ],
        "driver": "sandbox_iokit_probe",
        "expected": "allow",
        "expected_predicates": [
          "IOUSBHostInterface"
        ],
        "expected_primary_ops": [
          "iokit-open-service"
        ],
        "name": "S3_allow_both",
        "operation": "iokit-open-service",
        "probe_id": "anchor-filter-map:iokit_class:S3_allow_both",
        "supports_lanes": {
          "baseline": true,
          "oracle": true,
          "scenario": true
        },
        "target": "IOUSBHostInterface"
      },
      "anchor-filter-map:iokit_class:bogus_baseline": {
        "capabilities_required": [],
        "controls_supported": [
          "baseline",
          "allow_default",
          "deny_default"
        ],
        "driver": "sandbox_iokit_probe",
        "expected": "deny",
        "expected_predicates": [
          "IOSandboxLoreAnchorFilterBogus"
        ],
        "expected_primary_ops": [
          "iokit-open-service"
        ],
        "name": "bogus_baseline",
        "operation": "iokit-open-service",
        "probe_id": "anchor-filter-map:iokit_class:bogus_baseline",
        "supports_lanes": {
          "baseline": true,
          "oracle": true,
          "scenario": true
        },
        "target": "IOSandboxLoreAnchorFilterBogus"
      }
    },
    "registry_id": "anchor-filter-map",
    "schema_version": "runtime-tools.probe_registry.v0.2",
    "world_id": "sonoma-14.4.1-23E224-arm64-dyld-2c0602c5"
  },
  "profiles": {
    "profiles": {
      "anchor-filter-map:cfprefsd:C1_deny_global": {
        "family": "mach_lookup",
        "key_specific_rules": [
          "(deny mach-lookup (global-name \"com.apple.cfprefsd.agent\"))"
        ],
        "mode": "sbpl",
        "notes": null,
        "probe_refs": [
          "anchor-filter-map:cfprefsd:C1_deny_global"
        ],
        "profile_id": "anchor-filter-map:cfprefsd:C1_deny_global",
        "profile_path": "book/experiments/anchor-filter-map/sb/mach_lookup_allow_default.sb",
        "semantic_group": "mach:mapping-fidelity"
      },
      "anchor-filter-map:cfprefsd:C2_deny_local": {
        "family": "mach_lookup",
        "key_specific_rules": [
          "(deny mach-lookup (local-name \"com.apple.cfprefsd.agent\"))"
        ],
        "mode": "sbpl",
        "notes": null,
        "probe_refs": [
          "anchor-filter-map:cfprefsd:C2_deny_local"
        ],
        "profile_id": "anchor-filter-map:cfprefsd:C2_deny_local",
        "profile_path": "book/experiments/anchor-filter-map/sb/mach_lookup_allow_default.sb",
        "semantic_group": "mach:mapping-fidelity"
      },
      "anchor-filter-map:cfprefsd:N1_deny_default": {
        "family": "mach_lookup",
        "key_specific_rules": [
          "(allow mach-task-special-port-get)",
          "(allow mach-bootstrap)"
        ],
        "mode": "sbpl",
        "notes": null,
        "probe_refs": [
          "anchor-filter-map:cfprefsd:N1_deny_default",
          "anchor-filter-map:cfprefsd:bogus_baseline"
        ],
        "profile_id": "anchor-filter-map:cfprefsd:N1_deny_default",
        "profile_path": "book/experiments/anchor-filter-map/sb/mach_lookup_deny_default.sb",
        "semantic_group": "mach:predicate-discriminator"
      },
      "anchor-filter-map:cfprefsd:S0_allow_any": {
        "family": "mach_lookup",
        "key_specific_rules": [
          "(allow mach-task-special-port-get)",
          "(allow mach-bootstrap)",
          "(allow mach-lookup)"
        ],
        "mode": "sbpl",
        "notes": null,
        "probe_refs": [
          "anchor-filter-map:cfprefsd:S0_allow_any"
        ],
        "profile_id": "anchor-filter-map:cfprefsd:S0_allow_any",
        "profile_path": "book/experiments/anchor-filter-map/sb/mach_lookup_deny_default.sb",
        "semantic_group": "mach:predicate-discriminator"
      },
      "anchor-filter-map:cfprefsd:S1_allow_global": {
        "family": "mach_lookup",
        "key_specific_rules": [
          "(allow mach-task-special-port-get)",
          "(allow mach-bootstrap)",
          "(allow mach-lookup (global-name \"com.apple.cfprefsd.agent\"))"
        ],
        "mode": "sbpl",
        "notes": null,
        "probe_refs": [
          "anchor-filter-map:cfprefsd:S1_allow_global"
        ],
        "profile_id": "anchor-filter-map:cfprefsd:S1_allow_global",
        "profile_path": "book/experiments/anchor-filter-map/sb/mach_lookup_deny_default.sb",
        "semantic_group": "mach:predicate-discriminator"
      },
      "anchor-filter-map:cfprefsd:S2_allow_local": {
        "family": "mach_lookup",
        "key_specific_rules": [
          "(allow mach-task-special-port-get)",
          "(allow mach-bootstrap)",
          "(allow mach-lookup (local-name \"com.apple.cfprefsd.agent\"))"
        ],
        "mode": "sbpl",
        "notes": null,
        "probe_refs": [
          "anchor-filter-map:cfprefsd:S2_allow_local"
        ],
        "profile_id": "anchor-filter-map:cfprefsd:S2_allow_local",
        "profile_path": "book/experiments/anchor-filter-map/sb/mach_lookup_deny_default.sb",
        "semantic_group": "mach:predicate-discriminator"
      },
      "anchor-filter-map:cfprefsd:S3_allow_both": {
        "family": "mach_lookup",
        "key_specific_rules": [
          "(allow mach-task-special-port-get)",
          "(allow mach-bootstrap)",
          "(allow mach-lookup (global-name \"com.apple.cfprefsd.agent\") (local-name \"com.apple.cfprefsd.agent\"))"
        ],
        "mode": "sbpl",
        "notes": null,
        "probe_refs": [
          "anchor-filter-map:cfprefsd:S3_allow_both"
        ],
        "profile_id": "anchor-filter-map:cfprefsd:S3_allow_both",
        "profile_path": "book/experiments/anchor-filter-map/sb/mach_lookup_deny_default.sb",
        "semantic_group": "mach:predicate-discriminator"
      },
      "anchor-filter-map:iokit_class:C1_deny_class": {
        "family": "iokit_open",
        "key_specific_rules": [
          "(deny iokit-open-service (iokit-registry-entry-class \"IOUSBHostInterface\"))"
        ],
        "mode": "sbpl",
        "notes": null,
        "probe_refs": [
          "anchor-filter-map:iokit_class:C1_deny_class"
        ],
        "profile_id": "anchor-filter-map:iokit_class:C1_deny_class",
        "profile_path": "book/experiments/anchor-filter-map/sb/iokit_open_allow_default.sb",
        "semantic_group": "iokit:mapping-fidelity"
      },
      "anchor-filter-map:iokit_class:C2_deny_property_literal": {
        "family": "iokit_open",
        "key_specific_rules": [
          "(deny iokit-open-service (iokit-property \"IOUSBHostInterface\"))"
        ],
        "mode": "sbpl",
        "notes": null,
        "probe_refs": [
          "anchor-filter-map:iokit_class:C2_deny_property_literal"
        ],
        "profile_id": "anchor-filter-map:iokit_class:C2_deny_property_literal",
        "profile_path": "book/experiments/anchor-filter-map/sb/iokit_open_allow_default.sb",
        "semantic_group": "iokit:mapping-fidelity"
      },
      "anchor-filter-map:iokit_class:N1_deny_default": {
        "family": "iokit_open",
        "key_specific_rules": [
          "(allow mach-task-special-port-get)",
          "(allow mach-bootstrap)"
        ],
        "mode": "sbpl",
        "notes": null,
        "probe_refs": [
          "anchor-filter-map:iokit_class:N1_deny_default",
          "anchor-filter-map:iokit_class:bogus_baseline"
        ],
        "profile_id": "anchor-filter-map:iokit_class:N1_deny_default",
        "profile_path": "book/experiments/anchor-filter-map/sb/iokit_open_deny_default.sb",
        "semantic_group": "iokit:predicate-discriminator"
      },
      "anchor-filter-map:iokit_class:S0_allow_any": {
        "family": "iokit_open",
        "key_specific_rules": [
          "(allow mach-task-special-port-get)",
          "(allow mach-bootstrap)",
          "(allow iokit-open-service)"
        ],
        "mode": "sbpl",
        "notes": null,
        "probe_refs": [
          "anchor-filter-map:iokit_class:S0_allow_any"
        ],
        "profile_id": "anchor-filter-map:iokit_class:S0_allow_any",
        "profile_path": "book/experiments/anchor-filter-map/sb/iokit_open_deny_default.sb",
        "semantic_group": "iokit:predicate-discriminator"
      },
      "anchor-filter-map:iokit_class:S1_allow_class": {
        "family": "iokit_open",
        "key_specific_rules": [
          "(allow mach-task-special-port-get)",
          "(allow mach-bootstrap)",
          "(allow iokit-open-service (iokit-registry-entry-class \"IOUSBHostInterface\"))"
        ],
        "mode": "sbpl",
        "notes": null,
        "probe_refs": [
          "anchor-filter-map:iokit_class:S1_allow_class"
        ],
        "profile_id": "anchor-filter-map:iokit_class:S1_allow_class",
        "profile_path": "book/experiments/anchor-filter-map/sb/iokit_open_deny_default.sb",
        "semantic_group": "iokit:predicate-discriminator"
      },
      "anchor-filter-map:iokit_class:S2_allow_property_literal": {
        "family": "iokit_open",
        "key_specific_rules": [
          "(allow mach-task-special-port-get)",
          "(allow mach-bootstrap)",
          "(allow iokit-open-service (iokit-property \"IOUSBHostInterface\"))"
        ],
        "mode": "sbpl",
        "notes": null,
        "probe_refs": [
          "anchor-filter-map:iokit_class:S2_allow_property_literal"
        ],
        "profile_id": "anchor-filter-map:iokit_class:S2_allow_property_literal",
        "profile_path": "book/experiments/anchor-filter-map/sb/iokit_open_deny_default.sb",
        "semantic_group": "iokit:predicate-discriminator"
      },
      "anchor-filter-map:iokit_class:S3_allow_both": {
        "family": "iokit_open",
        "key_specific_rules": [
          "(allow mach-task-special-port-get)",
          "(allow mach-bootstrap)",
          "(allow iokit-open-service (iokit-registry-entry-class \"IOUSBHostInterface\") (iokit-property \"IOUSBHostInterface\"))"
        ],
        "mode": "sbpl",
        "notes": null,
        "probe_refs": [
          "anchor-filter-map:iokit_class:S3_allow_both"
        ],
        "profile_id": "anchor-filter-map:iokit_class:S3_allow_both",
        "profile_path": "book/experiments/anchor-filter-map/sb/iokit_open_deny_default.sb",
        "semantic_group": "iokit:predicate-discriminator"
      }
    },
    "registry_id": "anchor-filter-map",
    "schema_version": "runtime-tools.profile_registry.v0.2",
    "world_id": "sonoma-14.4.1-23E224-arm64-dyld-2c0602c5"
  },
  "registry_id": "anchor-filter-map",
  "schema_version": "runtime-tools.plan_template.v0.1",
  "template_id": "anchor-filter-map",
  "world_id": "sonoma-14.4.1-23E224-arm64-dyld-2c0602c5"
}
